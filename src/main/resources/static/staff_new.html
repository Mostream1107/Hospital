<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工服务台 - 医院门诊系统</title>
    <!-- 医院图标 -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M19 8h-2v3h-3v2h3v3h2v-3h3v-2h-3zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z'/%3E%3C/svg%3E">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            border-radius: 15px;
            margin: 20px;
            color: var(--primary-color);
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.15);
        }
        
        .function-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
        }
        
        .function-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 64px rgba(0,0,0,0.2);
        }
        
        .function-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2rem;
        }
        
        .icon-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .icon-success { background: linear-gradient(45deg, #56ab2f, #a8e6cf); color: white; }
        .icon-warning { background: linear-gradient(45deg, #f7b733, #fc4a1a); color: white; }
        .icon-info { background: linear-gradient(45deg, #4facfe, #00f2fe); color: white; }
        .icon-danger { background: linear-gradient(45deg, #ff416c, #ff4b2b); color: white; }
        .icon-secondary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .workflow-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .btn-modern {
            border-radius: 50px;
            padding: 12px 30px;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            border-bottom: none;
            border-radius: 20px 20px 0 0;
        }
        
        .workflow-step {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 15px;
            background: rgba(255,255,255,0.8);
            border-left: 4px solid var(--primary-color);
        }
        
        .workflow-step.active {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: var(--secondary-color);
        }
        
        .task-item {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-left: 3px solid var(--warning-color);
        }
        
        .task-item.completed {
            border-left-color: var(--success-color);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- 头部信息 -->
        <div class="main-header p-4">
            <div class="row align-items-center">
            <div class="col-md-6">
                    <h3 class="mb-1"><i class="bi bi-hospital"></i> 员工服务台</h3>
                    <p class="mb-0">欢迎，<span id="userName" class="fw-bold text-primary">员工</span> | <span id="userRole" class="text-muted">前台服务</span></p>
            </div>
            <div class="col-md-6 text-end">
                    <div class="d-flex align-items-center justify-content-end">
                        <div class="me-4">
                            <small class="text-muted">当前时间</small><br>
                            <span id="currentTime" class="fw-bold"></span>
                        </div>
                        <button class="btn btn-outline-danger btn-modern" onclick="logout()">
                            <i class="bi bi-box-arrow-right"></i> 退出
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 工作概览统计 -->
        <div class="container mt-4">
            <div class="row g-4 mb-5">
                <div class="col-md-3 col-sm-6">
                    <div class="card stats-card text-center p-4">
                        <div class="function-icon icon-primary mx-auto">
                            <i class="bi bi-person-plus"></i>
                        </div>
                        <div class="stat-number" id="todayRegistrations">-</div>
                        <div class="stat-label">今日挂号</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card stats-card text-center p-4">
                        <div class="function-icon icon-success mx-auto">
                            <i class="bi bi-cash-coin"></i>
                        </div>
                        <div class="stat-number" id="todayRevenue">-</div>
                        <div class="stat-label">今日收入</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card stats-card text-center p-4">
                        <div class="function-icon icon-warning mx-auto">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div class="stat-number" id="pendingPayments">-</div>
                        <div class="stat-label">待收费</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card stats-card text-center p-4">
                        <div class="function-icon icon-info mx-auto">
                            <i class="bi bi-people"></i>
                        </div>
                        <div class="stat-number" id="activePatients">-</div>
                        <div class="stat-label">在院病人</div>
                    </div>
                </div>
            </div>

            <!-- 核心服务功能 -->
            <div class="row g-4 mb-5">
                <!-- 病人接待服务 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card function-card p-4 text-center" onclick="openPatientReception()">
                        <div class="function-icon icon-primary">
                            <i class="bi bi-person-hearts"></i>
                        </div>
                        <h5 class="card-title">病人接待</h5>
                        <p class="card-text text-muted">病人信息查询<br>引导挂号就诊</p>
                        <button class="btn btn-primary btn-modern">接待服务</button>
                    </div>
                </div>
                
                <!-- 待收费处理 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card function-card p-4 text-center" onclick="openPendingPayments()">
                        <div class="function-icon icon-success">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <h5 class="card-title">待收费处理</h5>
                        <p class="card-text text-muted">处理待收费订单<br>确认收费状态</p>
                        <button class="btn btn-success btn-modern">处理收费</button>
                    </div>
                </div>
                
                <!-- 药品信息查询 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card function-card p-4 text-center" onclick="openMedicineQuery()">
                        <div class="function-icon icon-danger">
                            <i class="bi bi-capsule"></i>
                        </div>
                        <h5 class="card-title">药品咨询</h5>
                        <p class="card-text text-muted">药品信息查询<br>用法用量说明</p>
                        <button class="btn btn-danger btn-modern">药品查询</button>
                    </div>
                </div>
                
                <!-- 工作通知 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card function-card p-4 text-center" onclick="openNotifications()">
                        <div class="function-icon icon-info">
                            <i class="bi bi-bell"></i>
                        </div>
                        <h5 class="card-title">工作通知</h5>
                        <p class="card-text text-muted">查看系统通知<br>工作任务提醒</p>
                        <button class="btn btn-info btn-modern">查看通知</button>
                    </div>
                </div>
                
            </div>

            <!-- 今日工作流程 -->
            <div class="workflow-section p-4 mb-4">
                <h5 class="mb-3"><i class="bi bi-diagram-3-fill text-primary"></i> 今日工作流程</h5>
                <div class="row">
                    <div class="col-md-8">
                        <div id="workflowSteps">
                            <div class="workflow-step active">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clock text-primary me-2"></i>
                                    <strong>08:00 - 上班签到</strong>
                                    <span class="badge bg-success ms-auto">已完成</span>
                                </div>
                                <small class="text-muted ms-4">检查系统状态，准备接待工作</small>
                            </div>
                            <div class="workflow-step">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-person-plus text-warning me-2"></i>
                                    <strong>08:30 - 开始接待病人</strong>
                                    <span class="badge bg-warning ms-auto">进行中</span>
                                </div>
                                <small class="text-muted ms-4">协助病人挂号，提供咨询服务</small>
                            </div>
                            <div class="workflow-step">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-receipt text-secondary me-2"></i>
                                    <strong>全天 - 处理收费业务</strong>
                                    <span class="badge bg-secondary ms-auto">待开始</span>
                                </div>
                                <small class="text-muted ms-4">确认收费订单，处理退费申请</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6>今日待办事项</h6>
                        <div id="todayTasks">
                            <div class="task-item">
                                <div class="d-flex justify-content-between">
                                    <span>处理3笔待收费订单</span>
                                    <small class="text-warning">待处理</small>
                                </div>
                            </div>
                            <div class="task-item">
                                <div class="d-flex justify-content-between">
                                    <span>回复病人咨询2条</span>
                                    <small class="text-warning">待处理</small>
                                </div>
                            </div>
                            <div class="task-item completed">
                                <div class="d-flex justify-content-between">
                                    <span>更新排班信息</span>
                                    <small class="text-success">已完成</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- 通用模态框 -->
    <div class="modal fade" id="universalModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">功能模块</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- 动态内容 -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentUser = null;

        // 检查权限
        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token || user.role !== 'STAFF') {
                window.location.href = 'login.html';
                return false;
            }
            
            currentUser = user;
            document.getElementById('userName').textContent = user.realName || user.username;
            return true;
        }

        // 更新时间
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('zh-CN');
        }

        // 加载今日统计数据
        async function loadTodayStats() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        updateStaffStats(result.data);
                    } else {
                        console.error('加载统计数据失败:', result.message);
                        setDefaultStats();
                    }
                } else {
                    console.error('HTTP错误:', response.status);
                    setDefaultStats();
                }
            } catch (error) {
                console.error('加载统计数据异常:', error);
                setDefaultStats();
            }
        }

        // 更新员工端统计显示
        function updateStaffStats(stats) {
            document.getElementById('todayRegistrations').textContent = stats.totalRegistrations || 0;
            document.getElementById('todayRevenue').textContent = formatCurrency(stats.totalRevenue || 0);
            
            const pendingPayments = stats.paymentStatusStats 
                ? (stats.paymentStatusStats.PENDING || 0)
                : 0;
            document.getElementById('pendingPayments').textContent = pendingPayments;
            document.getElementById('activePatients').textContent = stats.totalPatients || 0;
            
            console.log('员工端统计数据更新成功:', stats);
        }

        // 设置默认统计数据
        function setDefaultStats() {
            document.getElementById('todayRegistrations').textContent = '0';
            document.getElementById('todayRevenue').textContent = '¥0.00';
            document.getElementById('pendingPayments').textContent = '0';
            document.getElementById('activePatients').textContent = '0';
        }

        // 格式化货币显示
        function formatCurrency(amount) {
            return '¥' + parseFloat(amount || 0).toFixed(2);
        }

        // 核心功能模块
        function openPatientReception() {
            showModal('病人接待服务', `
                <div class="p-4">
                    <div class="text-center mb-4">
                        <div class="function-icon icon-primary mx-auto mb-3">
                            <i class="bi bi-person-hearts"></i>
                        </div>
                        <h5>病人接待服务</h5>
                        <p class="text-muted">为病人提供专业的接待和咨询服务</p>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-search" style="font-size: 2rem; color: var(--bs-primary);"></i>
                                    <h6 class="mt-2">病人查询</h6>
                                    <p class="small text-muted">查询病人基本信息和就诊记录</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="searchPatients()">开始查询</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-calendar-plus" style="font-size: 2rem; color: var(--bs-success);"></i>
                                    <h6 class="mt-2">协助挂号</h6>
                                    <p class="small text-muted">为病人提供挂号指导和预约服务</p>
                                    <button class="btn btn-outline-success btn-sm" onclick="guideRegistration()">挂号指导</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-info-circle" style="font-size: 2rem; color: var(--bs-info);"></i>
                                    <h6 class="mt-2">信息咨询</h6>
                                    <p class="small text-muted">提供医院信息和就诊流程指导</p>
                                    <button class="btn btn-outline-info btn-sm" onclick="showHospitalInfo()">查看信息</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-chat-left-text" style="font-size: 2rem; color: var(--bs-warning);"></i>
                                    <h6 class="mt-2">意见建议</h6>
                                    <p class="small text-muted">收集病人意见和建议</p>
                                    <button class="btn btn-outline-warning btn-sm" onclick="collectFeedback()">收集反馈</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        function openPendingPayments() {
            showModal('待收费处理', `
                <div class="p-4">
                    <div class="text-center mb-4">
                        <div class="function-icon icon-success mx-auto mb-3">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <h5>待收费订单处理</h5>
                        <p class="text-muted">处理系统中的待收费订单，确认收费状态</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 
                        <strong>功能说明：</strong>此功能用于处理医生开具的收费订单，确认病人付费状态。
                    </div>
                    
                    <div class="text-center">
                        <button class="btn btn-success" onclick="loadPendingPayments()">
                            <i class="bi bi-list"></i> 查看待收费订单
                        </button>
                    </div>
                </div>
            `);
        }


        function openMedicineQuery() {
            showModal('药品信息查询', `
                <div class="p-4">
                    <div class="text-center mb-4">
                        <div class="function-icon icon-danger mx-auto mb-3">
                            <i class="bi bi-capsule"></i>
                        </div>
                        <h5>药品咨询服务</h5>
                        <p class="text-muted">为病人提供药品信息查询和用药指导</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 
                        <strong>功能说明：</strong>查询药品基本信息、用法用量、注意事项等。
                    </div>
                    
                    <div class="text-center">
                        <button class="btn btn-danger" onclick="alert('药品查询功能开发中')">
                            <i class="bi bi-search"></i> 开始查询
                        </button>
                    </div>
                </div>
            `);
        }

        function openNotifications() {
            showModal('工作通知', `
                <div class="p-4">
                    <div class="text-center mb-4">
                        <div class="function-icon icon-info mx-auto mb-3">
                            <i class="bi bi-bell"></i>
                        </div>
                        <h5>工作通知与提醒</h5>
                    </div>
                    
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">系统维护通知</h6>
                                <small>2小时前</small>
                            </div>
                            <p class="mb-1">今晚21:00-22:00系统维护，请提前保存工作。</p>
                            <small>系统管理员</small>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">新增科室医生</h6>
                                <small>1天前</small>
                            </div>
                            <p class="mb-1">心内科新增李医生，从下周一开始接诊。</p>
                            <small>人事部</small>
                        </div>
                    </div>
                </div>
            `);
        }


        // 辅助功能
        function searchPatients() {
            alert('病人查询功能开发中');
        }

        function guideRegistration() {
            alert('挂号指导功能开发中');
        }

        function showHospitalInfo() {
            alert('医院信息功能开发中');
        }

        function collectFeedback() {
            alert('意见收集功能开发中');
        }

        function loadPendingPayments() {
            alert('待收费查询功能开发中');
        }

        // 显示模态框
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            new bootstrap.Modal(document.getElementById('universalModal')).show();
        }

        // 退出登录
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                updateTime();
                setInterval(updateTime, 1000);
                loadTodayStats();
            }
        });
    </script>
</body>
</html>
